<!DOCTYPE html>
{% load static %}
{% load tooltip_tags %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Peptide Database{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
</head>

<body>
<header>
    <!-- Aquí tu menú o logo -->
</header>

<main>
    {% block content %}
    <!-- El contenido específico de cada página va aquí -->
    {% endblock %}
</main>

<footer>
    <!-- Pie de página -->
</footer>

<!-- Scripts: CARGAR SIEMPRE AL FINAL DEL BODY -->
<script src="https://unpkg.com/htmx.org@1.9.2"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        tooltips.forEach(el => new bootstrap.Tooltip(el));

        // Inicializa truncado de funciones
        document.querySelectorAll(".text-preview.function").forEach(span => {
            const full = span.textContent.trim();
            if (full.length > 50) {
                span.dataset.full = full;
                span.dataset.truncated = full.slice(0, 50) + "…";
                span.textContent = span.dataset.truncated;
                span.dataset.expanded = "false";
            }
        });

        // Inicializa truncado de referencias (si fueran solo texto plano)
        document.querySelectorAll(".text-preview.references").forEach(span => {
            const full = span.textContent.trim();
            if (full.length > 50) {
                span.dataset.full = full;
                span.dataset.truncated = full.slice(0, 50) + "…";
                span.textContent = span.dataset.truncated;
                span.dataset.expanded = "false";
            }
        });
    });

    function toggleText(id) {
        const preview = document.getElementById(`function-preview-${id}`);
        const link = document.getElementById(`toggle-link-${id}`);
        const isOpen = preview.dataset.expanded === "true";

        if (isOpen) {
            preview.textContent = preview.dataset.truncated;
            link.textContent = "Show more";
            preview.dataset.expanded = "false";
        } else {
            preview.textContent = preview.dataset.full;
            link.textContent = "Show less";
            preview.dataset.expanded = "true";
        }
    }

    function toggleRef(id) {
        const preview = document.getElementById(`reference-preview-${id}`);
        const link = document.getElementById(`toggle-ref-${id}`);
        const isOpen = preview.dataset.expanded === "true";

        if (isOpen) {
            preview.innerHTML = preview.dataset.truncated;
            link.textContent = "Show more";
            preview.dataset.expanded = "false";
        } else {
            preview.innerHTML = preview.dataset.full;
            link.textContent = "Show less";
            preview.dataset.expanded = "true";
        }
    }

    function toggleTaxonomy(button) {
        const panel = button.nextElementSibling;
        const isVisible = panel.style.display === "block";
        panel.style.display = isVisible ? "none" : "block";
        button.textContent = isVisible ? "Show Taxonomy Details" : "Hide Taxonomy Details";
    }
</script>
</body>
</html>
